(function(){'use strict';CKEDITOR.plugins.add('widgetselection',{init:function(editor){if(CKEDITOR.env.webkit){var widgetselection=CKEDITOR.plugins.widgetselection;editor.on('contentDom',function(evt){var editor=evt.editor,doc=editor.document,editable=editor.editable();editable.attachListener(doc,'keydown',function(evt){var data=evt.data.$;if(evt.data.getKey()==65&&(CKEDITOR.env.mac&&data.metaKey||!CKEDITOR.env.mac&&data.ctrlKey)){CKEDITOR.tools.setTimeout(function(){if(!widgetselection.addFillers(editable)){widgetselection.removeFillers(editable);}},0);}},null,null,-1);editor.on('selectionCheck',function(evt){widgetselection.removeFillers(evt.editor.editable());});editor.on('paste',function(evt){evt.data.dataValue=widgetselection.cleanPasteData(evt.data.dataValue);});if('selectall'in editor.plugins){widgetselection.addSelectAllIntegration(editor);}});}}});CKEDITOR.plugins.widgetselection={startFiller:null,endFiller:null,fillerAttribute:'data-cke-filler-webkit',fillerContent:'&nbsp;',fillerTagName:'div',addFillers:function(editable){var editor=editable.editor;if(!this.isWholeContentSelected(editable)&&editable.getChildCount()>0){var firstChild=editable.getFirst(filterTempElements),lastChild=editable.getLast(filterTempElements);if(firstChild&&firstChild.type==CKEDITOR.NODE_ELEMENT&&!firstChild.isEditable()){this.startFiller=this.createFiller();editable.append(this.startFiller,1);}
if(lastChild&&lastChild.type==CKEDITOR.NODE_ELEMENT&&!lastChild.isEditable()){this.endFiller=this.createFiller(true);editable.append(this.endFiller,0);}
if(this.hasFiller(editable)){var rangeAll=editor.createRange();rangeAll.selectNodeContents(editable);rangeAll.select();return true;}}
return false;},removeFillers:function(editable){if(this.hasFiller(editable)&&!this.isWholeContentSelected(editable)){var startFillerContent=editable.findOne(this.fillerTagName+'['+this.fillerAttribute+'=start]'),endFillerContent=editable.findOne(this.fillerTagName+'['+this.fillerAttribute+'=end]');if(this.startFiller&&startFillerContent&&this.startFiller.equals(startFillerContent)){this.removeFiller(this.startFiller,editable);}else{this.startFiller=startFillerContent;}
if(this.endFiller&&endFillerContent&&this.endFiller.equals(endFillerContent)){this.removeFiller(this.endFiller,editable);}else{this.endFiller=endFillerContent;}}},cleanPasteData:function(data){if(data&&data.length){data=data.replace(this.createFillerRegex(),'').replace(this.createFillerRegex(true),'');}
return data;},isWholeContentSelected:function(editable){var range=editable.editor.getSelection().getRanges()[0];if(range){if(range&&range.collapsed){return false;}else{var rangeClone=range.clone();rangeClone.enlarge(CKEDITOR.ENLARGE_ELEMENT);return!!(rangeClone&&editable&&rangeClone.startContainer&&rangeClone.endContainer&&rangeClone.startOffset===0&&rangeClone.endOffset===editable.getChildCount()&&rangeClone.startContainer.equals(editable)&&rangeClone.endContainer.equals(editable));}}
return false;},hasFiller:function(editable){return editable.find(this.fillerTagName+'['+this.fillerAttribute+']').count()>0;},createFiller:function(onEnd){var filler=new CKEDITOR.dom.element(this.fillerTagName);filler.setHtml(this.fillerContent);filler.setAttribute(this.fillerAttribute,onEnd?'end':'start');filler.setAttribute('data-cke-temp',1);filler.setStyles({display:'block',width:0,height:0,padding:0,border:0,margin:0,position:'absolute',top:0,left:'-9999px',opacity:0,overflow:'hidden'});return filler;},removeFiller:function(filler,editable){if(filler){var editor=editable.editor,currentRange=editable.editor.getSelection().getRanges()[0],currentPath=currentRange.startPath(),range=editor.createRange(),insertedHtml,fillerOnStart,manuallyHandleCaret;if(currentPath.contains(filler)){insertedHtml=filler.getHtml();manuallyHandleCaret=true;}
fillerOnStart=filler.getAttribute(this.fillerAttribute)=='start';filler.remove();filler=null;if(insertedHtml&&insertedHtml.length>0&&insertedHtml!=this.fillerContent){editable.insertHtmlIntoRange(insertedHtml,editor.getSelection().getRanges()[0]);range.setStartAt(editable.getChild(editable.getChildCount()-1),CKEDITOR.POSITION_BEFORE_END);editor.getSelection().selectRanges([range]);}else if(manuallyHandleCaret){if(fillerOnStart){range.setStartAt(editable.getFirst().getNext(),CKEDITOR.POSITION_AFTER_START);}else{range.setEndAt(editable.getLast().getPrevious(),CKEDITOR.POSITION_BEFORE_END);}
editable.editor.getSelection().selectRanges([range]);}}},createFillerRegex:function(onEnd){var matcher=this.createFiller(onEnd).getOuterHtml().replace(/style="[^"]*"/gi,'style="[^"]*"').replace(/>[^<]*</gi,'>[^<]*<');return new RegExp((!onEnd?'^':'')+matcher+(onEnd?'$':''));},addSelectAllIntegration:function(editor){var widgetselection=this;editor.editable().attachListener(editor,'beforeCommandExec',function(evt){var editable=editor.editable();if(evt.data.name=='selectAll'&&editable){widgetselection.addFillers(editable);}},null,null,9999);}};function filterTempElements(el){return el.getName&&!el.hasAttribute('data-cke-temp');}})();